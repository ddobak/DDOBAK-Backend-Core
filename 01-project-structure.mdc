---
description: 
globs: 
alwaysApply: false
---
# 📦 Spring Boot 프로젝트 구조 규칙

## 🎯 핵심 원칙
- **Java 17**, **Spring Boot 3.5.0** 고정 (절대 버전 변경 금지)
- **Clean Code & Clean Architecture** 원칙 준수
- **도메인별 완전한 계층 분리** (controller, service, dto, entity, repository, exception)
- **Clean Architecture 3계층**: Application → Domain → Infrastructure
- **설정 관리**: `application.yml` 사용, 환경별 분리 (.env 보완)

## 🌐 메시지 정책 (절대 준수)
- **시스템 메시지**: API 응답, 에러 메시지, 로그 → **영어 사용**
- **코드 주석**: **한국어 사용**
- **에러 코드**: 천의 자리 체계 (2xxx 성공, 4xxx 클라이언트, 5xxx 서버)
- **API 응답**: 모든 API는 `ApiResponse<T>` 형식 필수

## 🔢 응답 코드 체계 (2024년 12월 업데이트)

### 도메인별 천의 자리 소유
- **1xxx**: Auth 도메인 (인증/인가)
- **2xxx**: User 도메인 (사용자 관리)  
- **3xxx**: DocumentProcess 도메인 (문서 처리) ✅ **완전 구현 완료**
- **4xxx**: ExternalContent 도메인 (외부 컨텐츠)
- **5xxx**: Common/System (공통 시스템 에러) ✅ 구현 완료

### 각 도메인 내 분류
- **x000~x099**: 정상 또는 경고 수준
- **x100~x999**: 에러

### 현재 구현 상태
```
✅ 완료:
- Common/System (5xxx): 5000-5099 성공, 5100-5399 에러
- DocumentProcess (3xxx): 3000-3099 성공, 3100-3399 에러
  ├── Clean Architecture 3계층 완전 구현
  ├── OCR 처리 기능 완성
  ├── 계약서 분석 기능 완성
  └── 분석 결과 조회 기능 완성

🔄 향후 구현 예정:
- Auth (1xxx): 1000-1099 성공, 1100-1999 에러
- User (2xxx): 2000-2099 성공, 2100-2999 에러  
- ExternalContent (4xxx): 4000-4099 성공, 4100-4999 에러
```

## 📁 필수 디렉터리 구조

```
src/main/java/com/sbpb/ddobak/server/
├── config/                       # 전역 설정
│   ├── SecurityConfig.java       # Spring Security 설정
│   ├── SwaggerConfig.java        # API 문서 설정
│   ├── RedisConfig.java          # Redis 연결 설정
│   ├── SQSConfig.java            # AWS SQS 설정
│   └── S3Config.java             # AWS S3 설정
│
├── domain/                       # 도메인별 모듈
│   ├── user/                     # 사용자 도메인 (2xxx)
│   │   ├── controller/
│   │   ├── service/
│   │   │   ├── application/     # Application Layer
│   │   │   ├── domain/          # Domain Layer
│   │   │   └── infrastructure/  # Infrastructure Layer
│   │   ├── dto/
│   │   ├── entity/
│   │   ├── repository/
│   │   └── exception/           # 향후 User 도메인 전용 예외 (2xxx)
│   ├── auth/                     # 인증 도메인 (1xxx)
│   │   ├── controller/
│   │   ├── service/
│   │   │   ├── application/     # Application Layer
│   │   │   ├── domain/          # Domain Layer
│   │   │   └── infrastructure/  # Infrastructure Layer
│   │   ├── dto/
│   │   ├── entity/
│   │   ├── repository/
│   │   ├── exception/           # 향후 Auth 도메인 전용 예외 (1xxx)
│   │   └── oauth/               # 소셜 로그인 클라이언트
│   ├── documentProcess/         # 문서 처리 도메인 (3xxx) ✅ **Clean Architecture 완전 구현**
│   │   ├── controller/
│   │   │   └── ContractController.java
│   │   ├── service/             # ✅ Clean Architecture 3계층 완성
│   │   │   ├── application/     # Application Layer (Use Case 조합)
│   │   │   │   ├── ContractApplicationService.java
│   │   │   │   └── impl/
│   │   │   │       └── ContractApplicationServiceImpl.java
│   │   │   ├── domain/          # Domain Layer (비즈니스 로직)
│   │   │   │   ├── ContractOcrService.java
│   │   │   │   ├── ContractAnalysisService.java
│   │   │   │   ├── ContractResultService.java
│   │   │   │   └── impl/
│   │   │   │       ├── ContractOcrServiceImpl.java
│   │   │   │       ├── ContractAnalysisServiceImpl.java
│   │   │   │       └── ContractResultServiceImpl.java
│   │   │   └── infrastructure/  # Infrastructure Layer (외부 연동)
│   │   │       ├── ExternalOcrService.java
│   │   │       ├── ExternalAnalysisService.java
│   │   │       └── impl/
│   │   │           ├── ExternalOcrServiceImpl.java
│   │   │           └── ExternalAnalysisServiceImpl.java
│   │   ├── dto/                 # ✅ 완성
│   │   │   ├── ContractOcrRequest.java
│   │   │   ├── ContractOcrResponse.java
│   │   │   ├── ContractAnalysisRequest.java
│   │   │   ├── ContractAnalysisResponse.java
│   │   │   └── AnalysisResultResponse.java
│   │   ├── entity/              # ✅ 완성
│   │   │   ├── Contract.java
│   │   │   ├── ContractOcrResult.java
│   │   │   ├── ContractAnalysis.java
│   │   │   └── ToxicClause.java
│   │   ├── repository/          # ✅ 완성
│   │   │   ├── ContractRepository.java
│   │   │   ├── ContractOcrResultRepository.java
│   │   │   ├── ContractAnalysisRepository.java
│   │   │   └── ToxicClauseRepository.java
│   │   └── exception/           # ✅ DocumentProcess 도메인 전용 예외 (3xxx) 완성
│   │       ├── DocumentProcessErrorCode.java      # 3100-3399 에러
│   │       ├── DocumentProcessSuccessCode.java    # 3000-3099 성공
│   │       ├── DocumentProcessBusinessException.java
│   │       ├── DocumentProcessExceptionHandler.java
│   │       ├── ContractExceptions.java
│   │       └── ContractAnalysisExceptions.java
│   └── externalContent/         # 외부 컨텐츠 도메인 (4xxx)
│       ├── controller/
│       ├── service/
│       │   ├── application/     # Application Layer
│       │   ├── domain/          # Domain Layer
│       │   └── infrastructure/  # Infrastructure Layer
│       ├── dto/
│       ├── entity/
│       ├── repository/
│       └── exception/           # 향후 ExternalContent 도메인 전용 예외 (4xxx)
│
├── common/                      # 공통 모듈 ✅ 완성
│   ├── exception/               # 예외 처리 ✅ 완성
│   │   ├── ErrorCode.java       # 공통 시스템 에러 (5xxx) ✅
│   │   ├── BusinessException.java # 예외 기반 클래스 (추적 ID, 속성 지원)
│   │   ├── GlobalExceptionHandler.java # 전역 예외 처리
│   │   ├── ValidationException.java # 검증 실패 예외
│   │   ├── ResourceNotFoundException.java # 리소스 없음 예외
│   │   ├── DuplicateResourceException.java # 중복 리소스 예외
│   │   └── ExternalServiceException.java # 외부 서비스 예외
│   ├── response/                # 공통 응답 형식 ✅ 완성
│   │   ├── ApiResponse.java     # 통일된 API 응답 (Generic, 추적 ID)
│   │   ├── SuccessCode.java     # 공통 시스템 성공 코드 (5xxx) ✅
│   │   └── PageResponse.java    # 페이징 응답 (Spring Data 연동)
│   └── utils/                   # 유틸리티
│       └── IdGenerator.java     # ID 생성 유틸리티
│
└── ServerApplication.java       # 메인 클래스
```

## 🏗️ Clean Architecture 3계층 구조 (DocumentProcess 도메인 완성)

### 🔄 의존성 방향 (Dependency Rule 준수)
```
Controller → Application → Domain → Infrastructure
     ↓           ↓          ↓           ↓
   UI Layer  Use Cases  Business   External APIs
            Orchestrator   Rules
```

### 📋 각 계층의 역할

#### **Application Layer** (Use Case 계층)
- **목적**: 여러 도메인 서비스를 조합하여 완전한 비즈니스 시나리오 실행
- **책임**: Use Case 조합, 트랜잭션 경계 관리, 플로우 제어
- **특징**: Controller에서 직접 호출하는 최상위 서비스
- **예시**: `ContractApplicationService` - OCR → 분석 → 결과 조회의 전체 플로우 관리

#### **Domain Layer** (비즈니스 로직 계층)
- **목적**: 핵심 비즈니스 규칙과 도메인 로직 처리
- **책임**: 각 기능별 순수한 비즈니스 로직, 도메인 규칙 검증
- **특징**: 외부에 의존하지 않는 순수한 도메인 서비스
- **예시**: `ContractOcrService`, `ContractAnalysisService` - 각각 OCR, 분석의 비즈니스 로직

#### **Infrastructure Layer** (기술 구현 계층)
- **목적**: 외부 시스템과의 연동 및 기술적 구현
- **책임**: 외부 API 호출, 파일 처리, 네트워크 통신
- **특징**: 가장 변경 가능성이 높은 계층, 도메인에 의존
- **예시**: `ExternalOcrService`, `ExternalAnalysisService` - 외부 OCR/AI API 호출

## 🔄 계층별 역할 정의

### Controller 계층
- `@RestController` 사용
- API 진입점 역할
- **Application Service**만 의존
- 요청 검증 (`@Valid`)
- 응답 형식 통일 (`ApiResponse<T>`)

### Service 계층 (Clean Architecture 적용)
- **Application Layer**: Use Case 조합, 비즈니스 플로우 관리
- **Domain Layer**: 핵심 비즈니스 로직, 도메인 규칙
- **Infrastructure Layer**: 외부 시스템 연동, 기술적 구현
- `@Transactional` 적절한 사용
- 의존성 주입을 통한 느슨한 결합

### Repository 계층
- `JpaRepository<Entity, ID>` 상속
- 커스텀 쿼리는 QueryDSL 또는 `@Query` 사용

### Entity 계층
- JPA 엔티티 정의
- 비즈니스 메서드 포함 가능
- DTO 변환은 별도 메서드로 분리

### DTO 계층
- 계층 간 데이터 전달
- `Request`, `Response` 접미사 사용
- Lombok 적극 활용 (`@Builder`, `@Getter` 등)

## 📋 명명 규칙

### 파일 명명
- **Controller**: `{Domain}Controller.java`
- **Application Service**: `{Domain}ApplicationService.java`
- **Domain Service**: `{Domain}{Feature}Service.java`
- **Infrastructure Service**: `External{Service}Service.java`
- **Repository**: `{Domain}Repository.java`
- **Entity**: `{Domain}.java` (단수형)
- **DTO**: `{Purpose}Request.java`, `{Purpose}Response.java`

### 패키지 명명
- 소문자, camelCase 사용
- 도메인명은 단수형 사용 (user, auth, documentProcess)
- Clean Architecture 계층명: application, domain, infrastructure

## 🚫 금지 사항
- **Java 17 또는 Spring Boot 3.5.0 버전 변경 절대 금지**
- Entity를 Controller에서 직접 노출 금지
- 순환 의존성 생성 금지
- **Dependency Rule 위반 금지**: 상위 계층이 하위 계층에 의존해야 함
- 도메인 간 직접 의존성 금지 (common을 통한 간접 참조만 허용)
- **계층 건너뛰기 금지**: Controller → Domain 직접 호출 등

## ✅ DocumentProcess 도메인 구현 완료 사항
1. **Clean Architecture 3계층 완전 구현**
2. **OCR 처리 기능**: 파일 업로드 → OCR 텍스트 추출 → 저장
3. **계약서 분석 기능**: OCR 결과 → AI 분석 → 독소 조항 탐지
4. **분석 결과 조회 기능**: 저장된 분석 결과 및 독소 조항 조회
5. **완전한 예외 처리**: 도메인별 에러 코드 및 예외 핸들링
6. **API 응답 표준화**: 모든 API가 `ApiResponse<T>` 형식 사용
